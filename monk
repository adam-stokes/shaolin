#!/usr/bin/env perl

use Modern::Perl;
use Applify;
use CI::Repo;

version 0.01;
documentation __FILE__;

subcommand repo => 'Repo management' => sub {
    option bool => forks => "Sync upstream repo forks";
    option str => items => "Path to reactive/charm/ancillary items", required => 1, n_of => 1;
};

sub command_repo {
    my $app = shift;
    my $action = shift || 'forks';
    my $repo = CI::Repo->new(
        items => $app->{items},
    );
    $action =~ s/-/_/g;

    $repo->abort("Unknown action: $action") if !$repo->can($action);
    $repo->$action;
    return 0;
}

app {
    my $self = shift;
    return 0;
};

__END__

=head1 NAME

monk - CLI for CI

=head1 SYNOPSIS

    # Sync upstream git repos
    $ monk repo --items my-layers.yaml --items my-charms.yaml forks

=head1 AUTHOR

Adam Stokes - c<adamjs@cpan.org>

=cut
